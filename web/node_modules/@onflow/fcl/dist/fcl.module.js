import{config as e}from"@onflow/config";export{config}from"@onflow/config";import{resolve as t,send as r,script as n,args as o,limit as i,decode as u,arg as a,pipe as s,interaction as c,getTransactionStatus as l,latestBlock as d}from"@onflow/sdk";export{account,arg,args,atBlockHeight,atBlockId,authorization,authorizations,build,decode,getAccount,getBlock,getBlockByHeight,getBlockById,getBlockHeader,getCollection,getEvents,getEventsAtBlockHeightRange,getEventsAtBlockIds,getLatestBlock,getTransaction,getTransactionStatus,invariant,isBad,isOk,latestBlock,limit,param,params,payer,ping,pipe,proposer,ref,script,send,transaction,validator,why}from"@onflow/sdk";import{invariant as f}from"@onflow/util-invariant";import*as h from"@onflow/types";import{INIT as p,SUBSCRIBE as m,UPDATED as v,UNSUBSCRIBE as y,SNAPSHOT as P,subscriber as g,spawn as E,snapshoter as w,send as b}from"@onflow/util-actor";import{withPrefix as S,sansPrefix as R}from"@onflow/util-address";export{display,sansPrefix,withPrefix}from"@onflow/util-address";import{encode as I}from"@onflow/rlp";import{uid as A}from"@onflow/util-uid";export{template as cadence,template as cdc}from"@onflow/util-template";e().put("accessNode.api","http://localhost:8080").put("challenge.handshake","http://localhost:8700/authenticate"),e().put("sdk.resolve",t);var T,j,k="0.0.70",C=function(e){void 0===e&&(e={});try{return Promise.resolve(function(e){try{return f(O(e.cadence),"query({ cadence }) -- cadence is required"),f(N(e.cadence),"query({ cadence }) -- cadence must be a string"),Promise.resolve()}catch(e){return Promise.reject(e)}}(e)).then(function(){return r([n(e.cadence),o((t=e.args||[],"function"==typeof t?t(a,h):[])),e.limit&&"number"==typeof e.limit&&i(e.limit)]).then(u);var t})}catch(e){return Promise.reject(e)}},O=function(e){return null!=typeof e},N=function(e){return"string"==typeof e},_=function(r,n){void 0===r&&(r=[]),void 0===n&&(n={});try{return Promise.resolve(e().get("sdk.resolve",n.resolve||t(n))).then(function(e){function t(){return Promise.resolve(e(r)).then(function(e){return JSON.stringify(e,null,2)})}var n=function(){if(Array.isArray(r))return Promise.resolve(s(c(),r)).then(function(e){r=e})}();return n&&n.then?n.then(t):t()})}catch(e){return Promise.reject(e)}},x=function(e){try{return Promise.resolve(r([l(e)]).then(u))}catch(e){return Promise.reject(e)}},L=function(e){return e.status>=4},U=function(e){return e.status>=3},D=function(e){return e.status>=2},z=((T={})[p]=function(e){try{return Promise.resolve(x(e.self())).then(function(t){L(t)||setTimeout(function(){return e.sendSelf("POLL")},2500),e.merge(t)})}catch(e){return Promise.reject(e)}},T[m]=function(e,t){e.subscribe(t.from),e.send(t.from,v,e.all())},T[y]=function(e,t){e.unsubscribe(t.from)},T[P]=function(e,t){try{return t.reply(e.all()),Promise.resolve()}catch(e){return Promise.reject(e)}},T.POLL=function(e){try{return Promise.resolve(x(e.self())).then(function(t){var r,n;L(t)||setTimeout(function(){return e.sendSelf("POLL")},2500),r=e.all(),n=t,JSON.stringify(r)!==JSON.stringify(n)&&e.broadcast(v,t),e.merge(t)})}catch(e){return Promise.reject(e)}},T),F=function(e){if("object"==typeof e&&(e=e.transactionId),null==e)throw new Error("transactionId required");return e},H=function(e){return E(z,F(e))};function B(e){function t(t){return g(F(e),H,t)}function r(e){return function(r){void 0===r&&(r={});var n=r.suppress||!1;return new Promise(function(r,o){var i=t(function(t){t.statusCode&&!n?(o(t.errorMessage),i()):e(t)&&(r(t),i())})})}}return{snapshot:function(){return w(e,H)},subscribe:t,onceFinalized:r(D),onceExecuted:r(U),onceSealed:r(L)}}function M(){return(M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function G(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return J(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?J(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}B.isUnknown=function(e){return e.status>=0},B.isPending=function(e){return e.status>=1},B.isFinalized=D,B.isExecuted=U,B.isSealed=L,B.isExpired=function(e){return 5===e.status};var q=function(t){try{var r=setTimeout;return Promise.resolve(e().get("fcl.eventPollRate",1e4)).then(function(e){return r(function(){return t.sendSelf("TICK")},e)})}catch(e){return Promise.reject(e)}},Y=((j={}).TICK=function(e){try{if(!e.hasSubs())return Promise.resolve();var t=e.get("hwm"),n=function(){if(null==t){var n=e.put;return Promise.resolve(d()).then(function(t){n.call(e,"hwm",t);var r=e.put;return Promise.resolve(q(e)).then(function(t){r.call(e,"tick",t)})})}return Promise.resolve(d()).then(function(n){return e.put("hwm",n),Promise.resolve(r([getEvents(e.self(),t.height,n.height-1)]).then(u)).then(function(t){for(var r,n=G(t);!(r=n()).done;)e.broadcast("UPDATED",r.value.data);var o=e.put;return Promise.resolve(q(e)).then(function(t){o.call(e,"tick",t)})})})}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},j[m]=function(e,t){try{var r=function(){e.subscribe(t.from)},n=function(){if(!e.hasSubs()){var t=e.put;return Promise.resolve(q(e)).then(function(r){t.call(e,"tick",r)})}}();return Promise.resolve(n&&n.then?n.then(r):r())}catch(e){return Promise.reject(e)}},j[y]=function(e,t){e.unsubscribe(t.from),e.hasSubs()||(clearTimeout(e.get("tick")),e.delete("tick"),e.delete("hwm"))},j),V=function(e){return E(Y,e)};function Z(e){return{subscribe:function(t){return g(e,V,t)}}}var K={f_type:"Service",f_vsn:"1.0.0"},X={f_type:"Identity",f_vsn:"1.0.0"},W={f_type:"USER",f_vsn:"1.0.0"},$={f_type:"PollingResponse",f_vsn:"1.0.0"},Q={f_type:"CompositeSignature",f_vsn:"1.0.0"};function ee(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return M({old:e},K,{type:"frame",endpoint:e.endpoint,params:e.params||{},data:e.data||{}})}}function te(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return M({},K,{type:"back-channel-rpc",endpoint:e.endpoint,method:e.method,params:e.params||{},data:e.data||{}})}}var re={"back-channel-rpc":te,"pre-authz":function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return M({},K,{type:e.type,uid:e.id,endpoint:e.endpoint,method:e.method,identity:M({},X,{address:S(e.addr),keyId:e.keyId}),params:e.params,data:e.data})}},authz:function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return M({},K,{type:e.type,uid:e.id,endpoint:e.endpoint,method:e.method,identity:M({},X,{address:S(e.addr),keyId:e.keyId}),params:e.params,data:e.data})}},authn:function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return M({},K,{type:e.type,uid:e.id,endpoint:e.authn,id:e.pid,provider:{address:S(e.addr),name:e.name,icon:e.icon}})}},frame:ee,"open-id":function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return null}}};function ne(e){return I([e.provider.address||e.provider.name||"UNSPECIFIED",e.id]).toString("hex")}function oe(e,t){return void 0===e&&(e=[]),e.find(function(e){return e.type===t})}function ie(e){var t=new URL(e.endpoint);if(t.searchParams.append("l6n",window.location.origin),null!=e.params)for(var r=0,n=Object.entries(e.params||{});r<n.length;r++){var o=n[r];t.searchParams.append(o[0],o[1])}return t}function ue(e,t){void 0===t&&(t={});var r=t.method||"POST",n="GET"===r?void 0:JSON.stringify(t.data||e.data||{});return fetch(ie(e),{method:r,headers:M({},e.headers||{},t.headers||{},{"Content-Type":"application/json"}),body:n}).then(function(e){return e.json()})}function ae(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return M({},$,{status:e.status,reason:e.reason,data:e.compositeSignature||e.data||{},updates:te(e.authorizationUpdates),local:ee((e.local||[])[0])})}}function se(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return M({},Q,{addr:R(e.addr||e.address),signature:e.signature||e.sig,keyId:e.keyId})}}var ce="FCL_IFRAME",le=function(){},de=new Set(["monetizationstart","monetizationpending","monetizationprogress","monetizationstop"]);function fe(e,t){if(void 0===t&&(t={}),null==e)return{send:le,close:le};var r=t.onClose||le,n=t.onMessage||le,o=t.onReady||le,i=t.onResponse||le;window.addEventListener("message",c);var u=function(e){f(!document.getElementById(ce),"Attempt at triggering multiple Frames",{src:e});var t=document.createElement("iframe");return t.src=e,t.id=ce,t.allow="usb *",t.frameBorder="0",t.style.cssText="\n  position:fixed;\n  top: 0px;\n  right: 0px;\n  bottom: 0px;\n  left: 0px;\n  height: 100vh;\n  width: 100vw;\n  display:block;\n  background:rgba(0,0,0,0.25);\n  z-index: 2147483647;\n  box-sizing: border-box;\n",document.body.append(t),[t,function(){document.getElementById(ce)&&document.getElementById(ce).remove()}]}(ie(e)),a=u[0],s=u[1];return{send:d,close:l};function c(e){try{if("object"!=typeof e.data)return;if(de.has(e.data.type))return;"FCL:FRAME:CLOSE"===e.data.type&&l(),"FCL:FRAME:READY"===e.data.type&&o(e,{send:d,close:l}),"FCL:FRAME:RESPONSE"===e.data.type&&i(e,{send:d,close:l}),n(e,{send:d,close:l}),"FCL::CHALLENGE::RESPONSE"===e.data.type&&i(e,{send:d,close:l}),"FCL::AUTHZ_READY"===e.data.type&&o(e,{send:d,close:l}),"FCL::CHALLENGE::CANCEL"===e.data.type&&l(),"FCL::CANCEL"===e.data.type&&l()}catch(e){console.error("Frame Callback Error",e),l()}}function l(){try{window.removeEventListener("message",c),s(),r()}catch(e){console.error("Frame Close Error",e)}}function d(e){try{a.contentWindow.postMessage(JSON.parse(JSON.stringify(e||{})),"*")}catch(t){console.error("Frame Send Error",e,t)}}}var he,pe={"HTTP/GET":"GET","HTTP/POST":"POST"},me=function(e){return f(pe[e.method],"Invalid Service Method for type back-channel-rpc",{service:e}),pe[e.method]},ve=function(e,t){try{return t.data=e.data,Promise.resolve(ue(e,{data:t}).then(ae)).then(function(t){if("APPROVED"===t.status)return t.data;if("DECLINED"===t.status)throw new Error("Declined: "+(t.reason||"No reason supplied."));if("PENDING"===t.status){var r=!0,n=fe(t.local,{onClose:function(){r=!1}}).close;return function e(t,r){void 0===r&&(r=function(){return!0});try{if(f(t,"Missing Polling Service",{service:t}),!r())throw new Error("Externally Halted");return Promise.resolve(ue(t,{method:me(t)}).then(ae)).then(function(t){switch(t.status){case"APPROVED":return t.data;case"DECLINED":throw new Error("Declined: "+(t.reason||"No reason supplied."));default:return Promise.resolve(new Promise(function(e){return setTimeout(e,500)})).then(function(){return e(t.updates,r)})}})}catch(e){return Promise.reject(e)}}(t.updates,function(){return r}).then(function(e){return n(),se(e)}).catch(function(e){throw console.error(e),n(),e})}throw console.error("Auto Decline: Invalid Response",{service:e,resp:t}),new Error("Auto Decline: Invalid Response")})}catch(e){return Promise.reject(e)}},ye=function(e,t){try{try{return Promise.resolve(Pe[e.method](e,t))}catch(r){throw console.error("execService(service, msg)",r,{service:e,msg:t}),r}}catch(e){return Promise.reject(e)}},Pe={"HTTP/RPC":ve,"HTTP/POST":ve,"IFRAME/RPC":function(e,t){return new Promise(function(r,n){var o=A();t.data=e.data,fe(e,{onReady:function(r,n){var i=n.send;try{i({jsonrpc:"2.0",id:o,method:"fcl:sign",params:[t,e.params]})}catch(e){throw e}},onClose:function(){n("Declined: Externally Halted")},onMessage:function(e,t){var i=t.close;try{if("object"!=typeof e.data)return;if("2.0"!==e.data.jsonrpc)return;if(e.data.id!==o)return;var u=ae(e.data.result);switch(u.status){case"APPROVED":r(se(u.data)),i();break;case"DECLINED":n("Declined: "+(u.reason||"No reason supplied")),i();break;default:n("Declined: No reason supplied"),i()}}catch(e){throw console.error("execIframeRPC onMessage error",e),e}}})})}};function ge(e,t,r){if(!e.s){if(r instanceof we){if(!r.s)return void(r.o=ge.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(ge.bind(null,e,t),ge.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var Ee=function(e){try{return Ne(),Promise.resolve(Se()).then(function(t){var r=oe(t.services,"authz"),n=oe(t.services,"pre-authz");return M({},e,n?{tempId:"CURRENT_USER",resolve:function(e,t){try{return Promise.resolve(ye(n,t)).then(Le)}catch(e){return Promise.reject(e)}}}:{tempId:"CURRENT_USER",resolve:null,addr:R(r.identity.address),keyId:r.identity.keyId,sequenceNum:null,signature:null,signingFunction:function(e){try{return Promise.resolve(ye(r,e))}catch(e){return Promise.reject(e)}}})})}catch(e){return Promise.reject(e)}},we=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,o=this.s;if(o){var i=1&o?t:r;if(i){try{ge(n,1,i(this.v))}catch(e){ge(n,2,e)}return n}return this}return this.o=function(e){try{var o=e.v;1&e.s?ge(n,1,t?t(o):o):r?ge(n,1,r(o)):ge(n,2,o)}catch(e){ge(n,2,e)}},n},e}();function be(e){return e instanceof we&&1&e.s}var Se=function(){try{return Promise.resolve(new Promise(function(t,r){try{return Ne(),Promise.resolve(De()).then(function(r){return r.loggedIn&&_e(r)?t(r):Promise.resolve(e().get("discovery.wallet")).then(function(r){function n(e){fe({endpoint:e},{onReady:function(e,t){var r=t.send;try{return Promise.resolve(Re(/^service\./)).then(function(e){return Promise.resolve(Re(/^app\.detail\./)).then(function(t){r({type:"FCL:AUTHN:CONFIG",services:e,app:t})})})}catch(e){return Promise.reject(e)}},onClose:function(){try{return Promise.resolve(De()).then(function(e){t(e)})}catch(e){return Promise.reject(e)}},onResponse:function(e,r){var n=r.close;try{return Promise.resolve(function(e){try{var t=(e=function(e){return e.addr=e.addr?S(e.addr):null,e.paddr=e.paddr?S(e.paddr):null,e}(e)).services||[];return Promise.resolve(function(e,t){try{if(null==e||null==t)return Promise.resolve([]);var r=new URL(e);return r.searchParams.append("code",t),Promise.resolve(fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()})).then(function(e){if(Array.isArray(e))return e;var t=[];if(Array.isArray(e.authorizations))for(var r,n=G(e.authorizations);!(r=n()).done;)t.push(M({type:"authz",keyId:e.keyId},r.value));return null!=e.provider&&t.push(M({type:"authn",id:"wallet-provider#authn"},e.provider)),t})}catch(e){return Promise.reject(e)}}(e.hks,e.code)).then(function(r){var n,o,i=(n=t,o=r,void 0===n&&(n=[]),void 0===o&&(o=[]),[].concat(n,o)).map(function(t){return function(e,t){try{return re[e.type](e,t)}catch(t){return console.error("Unrecognized FCL Service Type ["+e.type+"]",e,t),e}}(t,e)}),u=function(e,t){return t.find(function(e){return"authn"===e.type})}(0,i);return M({},W,{addr:S(e.addr),cid:ne(u),loggedIn:!0,services:i,expiresAt:e.exp})})}catch(e){return Promise.reject(e)}}(e.data)).then(function(e){return b(Ie,Te,e),Promise.resolve(De()).then(function(e){t(e),n()})})}catch(e){return Promise.reject(e)}}})}return r?n(r):Promise.resolve(e().get("challenge.handshake")).then(n)})})}catch(e){return Promise.reject(e)}}))}catch(e){return Promise.reject(e)}},Re=function(t){try{return Promise.resolve(e().where(t)).then(function(e){return Object.fromEntries(Object.entries(e).map(function(e){var r=e[1];return[e[0].replace(t,""),r]}))})}catch(e){return Promise.reject(e)}},Ie="CURRENT_USER",Ae="CURRENT_USER/UPDATED",Te="SET_CURRENT_USER",je='{\n  "f_type": "User",\n  "f_vsn": "1.0.0",\n  "addr":null,\n  "cid":null,\n  "loggedIn":null,\n  "expiresAt":null,\n  "services":[]\n}',ke=function(e){try{return sessionStorage.setItem(Ie,JSON.stringify(e)),Promise.resolve(e)}catch(e){return Promise.reject(e)}},Ce=function(){return e().get("persistSession",!0)},Oe=((he={})[p]=function(e){try{return e.merge(JSON.parse(je)),Promise.resolve(Ce()).then(function(t){var r=function(){if(t)return Promise.resolve(function(){try{var e=JSON.parse(je),t=JSON.parse(sessionStorage.getItem(Ie));return null!=t&&e.f_vsn!==t.f_vsn?(sessionStorage.removeItem(Ie),Promise.resolve(e)):Promise.resolve(t||e)}catch(e){return Promise.reject(e)}}()).then(function(t){_e(t)&&e.merge(t)})}();if(r&&r.then)return r.then(function(){})})}catch(e){return Promise.reject(e)}},he[m]=function(e,t){e.subscribe(t.from),e.send(t.from,Ae,M({},e.all()))},he[y]=function(e,t){e.unsubscribe(t.from)},he.SNAPSHOT=function(e,t){try{return t.reply(M({},e.all())),Promise.resolve()}catch(e){return Promise.reject(e)}},he[Te]=function(e,t,r){try{return e.merge(r),Promise.resolve(Ce()).then(function(t){t&&ke(e.all()),e.broadcast(Ae,M({},e.all()))})}catch(e){return Promise.reject(e)}},he.DEL_CURRENT_USER=function(e,t){try{return e.merge(JSON.parse(je)),Promise.resolve(Ce()).then(function(t){t&&ke(e.all()),e.broadcast(Ae,M({},e.all()))})}catch(e){return Promise.reject(e)}},he),Ne=function(){return E(Oe,Ie)};function _e(e){return null==e.expiresAt||0===e.expiresAt||e.expiresAt>Date.now()}function xe(){Ne(),b(Ie,"DEL_CURRENT_USER")}function Le(e){var t=function(e){return{f_type:"PreAuthzResponse",f_vsn:"1.0.0",proposer:(e||{}).proposer,payer:(e||{}).payer||[],authorization:(e||{}).authorization||[]}}(e),r=[];null!=t.proposer&&r.push(["PROPOSER",t.proposer]);for(var n,o=G(t.payer||[]);!(n=o()).done;)r.push(["PAYER",n.value]);for(var i,u=G(t.authorization||[]);!(i=u()).done;)r.push(["AUTHORIZER",i.value]);return r.map(function(e){var t=e[0],r=e[1];return{tempId:[r.identity.address,r.identity.keyId].join("|"),addr:r.identity.address,keyId:r.identity.keyId,signingFunction:function(e){return ye(r,e)},role:{proposer:"PROPOSER"===t,payer:"PAYER"===t,authorizer:"AUTHORIZER"===t}}})}function Ue(e){Ne();var t=E(function(t){try{var r;return t.send(Ie,m),Promise.resolve(function(e,t,r){for(var n;;){var o=e();if(be(o)&&(o=o.v),!o)return i;if(o.then){n=0;break}var i=r();if(i&&i.then){if(!be(i)){n=1;break}i=i.s}}var u=new we,a=ge.bind(null,u,2);return(0===n?o.then(c):1===n?i.then(s):(void 0).then(function(){(o=e())?o.then?o.then(c).then(void 0,a):c(o):ge(u,1,i)})).then(void 0,a),u;function s(t){i=t;do{if(!(o=e())||be(o)&&!o.v)return void ge(u,1,i);if(o.then)return void o.then(c).then(void 0,a);be(i=r())&&(i=i.v)}while(!i||!i.then);i.then(s).then(void 0,a)}function c(e){e?(i=r())&&i.then?i.then(s).then(void 0,a):s(i):ge(u,1,i)}}(function(){return!r&&1},0,function(){return Promise.resolve(t.receive()).then(function(n){if("@EXIT"===n.tag)return t.send(Ie,y),void(r=1);e(n.data)})}))}catch(e){return Promise.reject(e)}});return function(){return b(t,"@EXIT")}}function De(){return Ne(),b(Ie,"SNAPSHOT",null,{expectReply:!0,timeout:0})}var ze=function(){return{authenticate:Se,unauthenticate:xe,authorization:Ee,subscribe:Ue,snapshot:De}},Fe=function(){return ze().authenticate()},He=function(){return ze().unauthenticate()},Be=function(){return ze().unauthenticate(),ze().authenticate()},Me=function(){return ze().authenticate()},Je=function(){return ze().authenticate()},Ge=ze().authorization,qe=h;export{k as VERSION,Fe as authenticate,Ge as authz,ze as currentUser,Z as events,Je as logIn,C as query,Be as reauthenticate,_ as serialize,Me as signUp,qe as t,B as tx,He as unauthenticate};
//# sourceMappingURL=fcl.module.js.map
