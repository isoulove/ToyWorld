{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { sansPrefix } from \"@onflow/fcl\";\nimport { atomFamily, selectorFamily, useRecoilState } from \"recoil\";\nimport { useCurrentUser } from \"../hooks/use-current-user.hook\";\nimport { fetchAccountItem } from \"../flow/fetch-account-item.script\";\nimport { createSaleOffer } from \"../flow/create-sale-offer.tx\";\nimport { IDLE, PROCESSING } from \"../global/constants\";\nimport { useAccountItems } from \"../hooks/use-account-items.hook\";\nimport { useMarketItems } from \"../hooks/use-market-items.hook\";\n\nfunction expand(key) {\n  return key.split(\"|\");\n}\n\nfunction comp(address, id) {\n  return [address, id].join(\"|\");\n}\n\nexport const $state = atomFamily({\n  key: \"account-item::state\",\n  default: selectorFamily({\n    key: \"account-item::default\",\n    get: key => async () => fetchAccountItem(...expand(key))\n  })\n});\nexport const $status = atomFamily({\n  key: \"account-item::status\",\n  default: IDLE\n});\nexport function useAccountItem(address, id) {\n  _s();\n\n  const [cu] = useCurrentUser();\n  const accountItems = useAccountItems(address);\n  const marketItems = useMarketItems();\n  const key = comp(address, id);\n  const [item, setItem] = useRecoilState($state(key));\n  const [status, setStatus] = useRecoilState($status(key));\n  return { ...item,\n    status,\n    forSale: marketItems.has(item),\n    owned: sansPrefix(cu.addr) === sansPrefix(address),\n\n    async sell(price) {\n      await createSaleOffer({\n        itemID: id,\n        price: price\n      }, {\n        onStart() {\n          setStatus(PROCESSING);\n        },\n\n        async onSuccess() {\n          accountItems.refresh();\n        },\n\n        async onComplete() {\n          setStatus(IDLE);\n        },\n\n        async onError(error) {// TODO: Handle error\n        }\n\n      });\n    },\n\n    async refresh() {\n      setStatus(PROCESSING);\n      await fetchAccountItem(...expand(key)).then(setItem);\n      setStatus(IDLE);\n    }\n\n  };\n}\n\n_s(useAccountItem, \"Fc5TEWIuNXCpMYosOKhOppF+Ksg=\", false, function () {\n  return [useCurrentUser, useAccountItems, useMarketItems, useRecoilState, useRecoilState];\n});","map":{"version":3,"sources":["/Users/wuchao/flow/nft/ToyWorld/web/src/hooks/use-account-item.hook.js"],"names":["sansPrefix","atomFamily","selectorFamily","useRecoilState","useCurrentUser","fetchAccountItem","createSaleOffer","IDLE","PROCESSING","useAccountItems","useMarketItems","expand","key","split","comp","address","id","join","$state","default","get","$status","useAccountItem","cu","accountItems","marketItems","item","setItem","status","setStatus","forSale","has","owned","addr","sell","price","itemID","onStart","onSuccess","refresh","onComplete","onError","error","then"],"mappings":"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","sourcesContent":["import {sansPrefix} from \"@onflow/fcl\"\nimport {atomFamily, selectorFamily, useRecoilState} from \"recoil\"\nimport {useCurrentUser} from \"../hooks/use-current-user.hook\"\nimport {fetchAccountItem} from \"../flow/fetch-account-item.script\"\nimport {createSaleOffer} from \"../flow/create-sale-offer.tx\"\nimport {IDLE, PROCESSING} from \"../global/constants\"\nimport {useAccountItems} from \"../hooks/use-account-items.hook\"\nimport {useMarketItems} from \"../hooks/use-market-items.hook\"\n\nfunction expand(key) {\n  return key.split(\"|\")\n}\n\nfunction comp(address, id) {\n  return [address, id].join(\"|\")\n}\n\nexport const $state = atomFamily({\n  key: \"account-item::state\",\n  default: selectorFamily({\n    key: \"account-item::default\",\n    get: key => async () => fetchAccountItem(...expand(key)),\n  }),\n})\n\nexport const $status = atomFamily({\n  key: \"account-item::status\",\n  default: IDLE,\n})\n\nexport function useAccountItem(address, id) {\n  const [cu] = useCurrentUser()\n  const accountItems = useAccountItems(address)\n  const marketItems = useMarketItems()\n  const key = comp(address, id)\n  const [item, setItem] = useRecoilState($state(key))\n  const [status, setStatus] = useRecoilState($status(key))\n\n  return {\n    ...item,\n    status,\n    forSale: marketItems.has(item),\n    owned: sansPrefix(cu.addr) === sansPrefix(address),\n    async sell(price) {\n      await createSaleOffer(\n        {itemID: id, price: price},\n        {\n          onStart() {\n            setStatus(PROCESSING)\n          },\n          async onSuccess() {\n            accountItems.refresh()\n          },\n          async onComplete() {\n            setStatus(IDLE)\n          },\n          async onError(error) {\n            // TODO: Handle error\n          },\n        }\n      )\n    },\n    async refresh() {\n      setStatus(PROCESSING)\n      await fetchAccountItem(...expand(key)).then(setItem)\n      setStatus(IDLE)\n    },\n  }\n}\n"]},"metadata":{},"sourceType":"module"}